<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MathQuest: Cosmic Challenge</title>
  <style>
    body {
      margin: 0;
      font-family: 'Courier New', monospace;
      background: #000;
      color: #fff;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow-y: auto;
    }

    .galaxy {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: 1;
      background: radial-gradient(circle, #3a0a6a 10%, #000 70%);
      animation: vortex 15s infinite linear;
    }

    @keyframes vortex {
      0% { background-position: 0 0; }
      100% { background-position: 1000px 1000px; }
    }

    .meteor {
      position: absolute;
      width: 8px;
      height: 8px;
      background: #ffeb3b;
      border-radius: 50%;
      box-shadow: 0 0 20px #ff4081;
      animation: explode 1.5s linear infinite;
    }

    @keyframes explode {
      0% { transform: translate(-50vw, -50vh); opacity: 1; }
      100% { transform: translate(50vw, 50vh); opacity: 0; }
    }

    .meteor:nth-child(1) { left: 20%; animation-delay: 0s; }
    .meteor:nth-child(2) { left: 40%; animation-delay: 0.4s; }
    .meteor:nth-child(3) { left: 60%; animation-delay: 0.8s; }
    .meteor:nth-child(4) { left: 80%; animation-delay: 1.2s; }

    .grid-floor {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 200px;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 10px,
        #00bcd4 10px,
        #00bcd4 12px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 10px,
        #00bcd4 10px,
        #00bcd4 12px
      );
      transform: perspective(500px) rotateX(60deg);
      opacity: 0.5;
      z-index: 1;
    }

    .container {
      text-align: center;
      max-width: 800px;
      padding: 10px;
      z-index: 2;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }

    h1 {
      font-size: 3em;
      text-transform: uppercase;
      color: #ffeb3b;
      text-shadow: 0 0 20px #ff4081, 0 0 40px #00bcd4;
      animation: glitch 2s infinite;
      margin-bottom: 10px;
    }

    @keyframes glitch {
      0%, 100% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(2px, -2px); }
    }

    .question {
      font-size: 1.5em;
      color: #00bcd4;
      text-shadow: 0 0 10px #00bcd4;
      margin-bottom: 15px;
    }

    .timer {
      font-size: 1.2em;
      color: #00bcd4;
      text-shadow: 0 0 8px #00bcd4;
      margin-bottom: 15px;
    }

    .calcbot {
      position: fixed;
      left: 2%;
      top: 10%;
      width: 80px;
      height: 80px;
      background: radial-gradient(#00bcd4, #00838f);
      border-radius: 50%;
      animation: hover 2.5s ease-in-out infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 15px #00bcd4;
      cursor: pointer;
      z-index: 3;
    }

    .calcbot::before {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      background: #ff4081;
      border-radius: 50%;
      top: 8px;
      left: 8px;
      animation: gear 3s linear infinite;
    }

    .calcbot::after {
      content: attr(data-text);
      position: absolute;
      top: -50px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 0.9em;
      color: #ffeb3b;
      text-shadow: 0 0 5px #ffeb3b;
      width: 120px;
      text-align: center;
      animation: bubble 3s infinite;
    }

    @keyframes hover {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(5deg); }
    }

    @keyframes gear {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes bubble {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    .answers {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 15px;
    }

    .answer-button {
      background: linear-gradient(45deg, #ff4081, #ffeb3b);
      color: #000;
      padding: 8px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 8px #ff4081;
      transition: transform 0.2s;
    }

    .answer-button:hover {
      transform: scale(1.1);
    }

    .answer-button:disabled {
      background: #444;
      box-shadow: none;
      cursor: not-allowed;
    }

    .result {
      font-size: 1.4em;
      margin-bottom: 15px;
      display: none;
    }

    .result.correct {
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
    }

    .result.incorrect {
      color: #ff0000;
      text-shadow: 0 0 10px #ff0000;
    }

    .next-button, .nav-button {
      background: linear-gradient(45deg, #ff4081, #ffeb3b);
      color: #000;
      padding: 8px 16px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 8px #ff4081;
      transition: transform 0.2s;
    }

    .next-button:hover, .nav-button:hover:not(:disabled) {
      transform: scale(1.1);
    }

    .nav-bar {
      position: fixed;
      top: 10px;
      left: 10px;
      display: flex;
      gap: 8px;
      z-index: 3;
    }

    .nav-button:disabled {
      background: #ffeb3b;
      box-shadow: 0 0 8px #ffeb3b;
      cursor: default;
    }

    .progress-graph {
      margin-top: 15px;
      display: none;
    }

    .progress-comment {
      font-size: 1em;
      color: #00bcd4;
      text-shadow: 0 0 6px #00bcd4;
      margin: 10px 0;
    }

    .review-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 15px;
      max-width: 800px;
      display: none;
    }

    .review-block {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #ff4081;
      border-radius: 8px;
      padding: 10px;
      color: #00bcd4;
      text-shadow: 0 0 4px #00bcd4;
      font-size: 0.8em;
      max-height: 150px;
      overflow-y: auto;
      box-shadow: 0 0 8px #ff4081;
    }

    .review-block h3 {
      margin: 0 0 8px;
      font-size: 1em;
      color: #ffeb3b;
      text-shadow: 0 0 4px #ffeb3b;
    }

    .review-block.overall {
      grid-column: 1 / 3;
    }

    .review-block ul {
      margin: 5px 0;
      padding-left: 15px;
    }

    .review-block p {
      margin: 3px 0;
    }
  </style>
</head>
<body>
  <div class="galaxy">
    <div class="meteor"></div>
    <div class="meteor"></div>
    <div class="meteor"></div>
    <div class="meteor"></div>
    <div class="grid-floor"></div>
  </div>
  <div class="container">
    <h1>Cosmic Challenge</h1>
    <div class="calcbot" data-text="Iâ€™m CalcBot! Click me for hints to solve these cosmic problems!" onclick="showHint(); playClickSound()"></div>
    <div class="timer"></div>
    <div class="question"></div>
    <div class="answers"></div>
    <div class="result"></div>
    <button class="next-button" style="display: none;" onclick="nextQuestion(); playClickSound()">Next Question</button>
    <canvas id="progressGraph" class="progress-graph" width="600" height="300"></canvas>
    <div class="progress-comment"></div>
    <div class="review-grid">
      <div class="review-block overall"></div>
      <div class="review-block" data-area="Numbers"></div>
      <div class="review-block" data-area="Algebra"></div>
      <div class="review-block" data-area="Measurement"></div>
      <div class="review-block" data-area="Data"></div>
    </div>
  </div>
  <div class="nav-bar">
    <button class="nav-button" onclick="window.location.href='index.html'; playClickSound()" onmouseover="playHoverSound()">Home</button>
    <button class="nav-button" onclick="window.location.href='mission_hub.html'; playClickSound()" onmouseover="playHoverSound()">Play</button>
    <button class="nav-button" disabled>Rewards</button>
  </div>
  <audio id="introSound" src="sounds/intro.mp3" preload="auto"></audio>
  <audio id="clickSound" src="sounds/beep.mp3" preload="auto"></audio>
  <audio id="hoverSound" src="sounds/blip.mp3" preload="auto"></audio>
  <audio id="correctSound" src="sounds/correct.mp3" preload="auto"></audio>
  <audio id="incorrectSound" src="sounds/incorrect.mp3" preload="auto"></audio>
  <script>
    const questions = {
      baseline: {
        0: [
          {
            question: "Calculate: -7 + 12 = ?",
            answers: ["5", "-19", "19", "-5"],
            correct_answer: "5",
            hint: "Add the numbers, keeping the sign in mind.",
            explanation: "-7 + 12 = 5. Think of moving 7 steps left and 12 steps right on a number line.",
            contentArea: "Numbers",
            topic: "Integer Operations"
          },
          {
            question: "Simplify and solve: 3/4 + 5/8 = ?",
            answers: ["8/12", "11/8", "7/8", "1/2"],
            correct_answer: "11/8",
            hint: "Find a common denominator for 4 and 8.",
            explanation: "3/4 = 6/8, so 6/8 + 5/8 = 11/8. Like combining 6 and 5 pieces of an 8-part pizza!",
            contentArea: "Numbers",
            topic: "Fractions"
          },
          {
            question: "A box contains 2/3 kg of sugar. You use 1/4 kg in a recipe. How much sugar is left?",
            answers: ["5/12 kg", "1/12 kg", "7/12 kg", "3/7 kg"],
            correct_answer: "5/12 kg",
            hint: "Subtract 1/4 from 2/3 using a common denominator.",
            explanation: "2/3 = 8/12, 1/4 = 3/12, so 8/12 - 3/12 = 5/12 kg. Imagine taking 3 pieces from 8 equal parts!",
            contentArea: "Numbers",
            topic: "Fractions"
          },
          {
            question: "Multiply: -3 Ã— 6 = ?",
            answers: ["18", "-18", "-9", "9"],
            correct_answer: "-18",
            hint: "Multiply the numbers and apply the negative sign.",
            explanation: "-3 Ã— 6 = -18. A negative times a positive gives a negative, like losing 3 stars 6 times.",
            contentArea: "Numbers",
            topic: "Integer Operations"
          },
          {
            question: "Find the next number in the sequence: 3, 6, 12, 24, ...",
            answers: ["30", "36", "48", "42"],
            correct_answer: "48",
            hint: "Each number doubles the previous one.",
            explanation: "Each term is multiplied by 2: 3 Ã— 2 = 6, 6 Ã— 2 = 12, 12 Ã— 2 = 24, 24 Ã— 2 = 48.",
            contentArea: "Algebra",
            topic: "Sequences"
          },
          {
            question: "If 2n + 3 = 13, what is the value of n?",
            answers: ["5", "6", "8", "4"],
            correct_answer: "5",
            hint: "Subtract 3, then divide by 2.",
            explanation: "2n + 3 = 13 â†’ 2n = 10 â†’ n = 5. Like balancing a scale by removing 3 and halving the rest.",
            contentArea: "Algebra",
            topic: "Equations"
          },
          {
            question: "Which rule fits this input-output table? Input: 1, 2, 3, 4; Output: 4, 6, 8, 10",
            answers: ["Multiply by 2", "Add 3", "Multiply by 2 and add 2", "Multiply by 2 and add 1"],
            correct_answer: "Multiply by 2 and add 2",
            hint: "Test each rule with the inputs.",
            explanation: "Output = 2 Ã— Input + 2. For Input 1: 2 Ã— 1 + 2 = 4; for 2: 2 Ã— 2 + 2 = 6, etc.",
            contentArea: "Algebra",
            topic: "Functions"
          },
          {
            question: "Complete the pattern: 5, 10, 15, 20, ... What is the 8th term?",
            answers: ["35", "40", "45", "50"],
            correct_answer: "40",
            hint: "Each term increases by 5; find the 8th term.",
            explanation: "The pattern adds 5 each time. The 8th term: 5 Ã— 8 = 40.",
            contentArea: "Algebra",
            topic: "Sequences"
          },
          {
            question: "Find the perimeter of a rectangle with length 8 cm and width 5 cm.",
            answers: ["26 cm", "40 cm", "13 cm", "30 cm"],
            correct_answer: "26 cm",
            hint: "Add all sides: 2 Ã— length + 2 Ã— width.",
            explanation: "Perimeter = 2 Ã— 8 + 2 Ã— 5 = 16 + 10 = 26 cm.",
            contentArea: "Measurement",
            topic: "Perimeter"
          },
          {
            question: "Calculate the area of a square with sides of length 7 m.",
            answers: ["49 mÂ²", "14 mÂ²", "28 mÂ²", "21 mÂ²"],
            correct_answer: "49 mÂ²",
            hint: "Area of a square is side Ã— side.",
            explanation: "Area = 7 Ã— 7 = 49 mÂ². Like covering a 7m Ã— 7m grid with tiles.",
            contentArea: "Measurement",
            topic: "Area"
          },
          {
            question: "Convert 3,500 ml to litres.",
            answers: ["0.35 L", "35 L", "3.5 L", "350 L"],
            correct_answer: "3.5 L",
            hint: "1 litre = 1,000 ml.",
            explanation: "3,500 ml Ã· 1,000 = 3.5 L. Like pouring 3,500 ml into litre bottles.",
            contentArea: "Measurement",
            topic: "Conversions"
          },
          {
            question: "A piece of string is 150 cm long. How many meters is this?",
            answers: ["1.5 m", "15 m", "0.15 m", "1500 m"],
            correct_answer: "1.5 m",
            hint: "1 meter = 100 cm.",
            explanation: "150 cm Ã· 100 = 1.5 m. Like measuring 150 cm with a meter stick.",
            contentArea: "Measurement",
            topic: "Conversions"
          },
          {
            question: "A survey showed: 8 learners like soccer, 5 like rugby, and 7 like cricket. How many learners were surveyed?",
            answers: ["15", "20", "10", "19"],
            correct_answer: "20",
            hint: "Add the number of learners for each sport.",
            explanation: "8 + 5 + 7 = 20 learners were surveyed.",
            contentArea: "Data",
            topic: "Data Analysis"
          },
          {
            question: "What fraction of learners like rugby? (From the above question)",
            answers: ["5/10", "5/20", "5/19", "7/20"],
            correct_answer: "5/20",
            hint: "Divide rugby fans by total learners.",
            explanation: "5 rugby fans out of 20 learners = 5/20.",
            contentArea: "Data",
            topic: "Fractions in Data"
          },
          {
            question: "If you toss a coin twice, what is the probability of getting 2 heads?",
            answers: ["1/4", "1/2", "1/3", "2/4"],
            correct_answer: "1/4",
            hint: "List all possible outcomes: HH, HT, TH, TT.",
            explanation: "There are 4 outcomes (HH, HT, TH, TT). Only 1 (HH) is 2 heads, so probability = 1/4.",
            contentArea: "Data",
            topic: "Probability"
          },
          {
            question: "A pie chart shows 1/4 of the learners like apples. If there are 40 learners, how many like apples?",
            answers: ["20", "8", "10", "12"],
            correct_answer: "10",
            hint: "Multiply 1/4 by 40.",
            explanation: "1/4 Ã— 40 = 10 learners like apples.",
            contentArea: "Data",
            topic: "Data Representation"
          }
        ]
      },
      numbers: { 1: [] },
      algebra: { 1: [] },
      measurement: { 1: [] },
      data: { 1: [] },
      geometry: { 1: [] }
    };

    let currentQuestion = 0;
    let score = 0;
    let galaxy, level, grade;
    let contentScores = {
      Numbers: 0,
      Algebra: 0,
      Measurement: 0,
      Data: 0
    };

    window.onload = function() {
      try {
        const introSound = document.getElementById('introSound');
        introSound.volume = 0.5;
        introSound.play().catch(error => console.log('Intro sound failed:', error));

        const urlParams = new URLSearchParams(window.location.search);
        galaxy = urlParams.get('galaxy') || 'baseline';
        level = parseInt(urlParams.get('level')) || 0;
        grade = parseInt(urlParams.get('grade')) || 7;

        console.log('URL Parameters:', { galaxy, level, grade });
        console.log('Questions available:', questions[galaxy] && questions[galaxy][level] ? questions[galaxy][level].length : 'none');

        loadQuestion();
      } catch (error) {
        console.error('Error in window.onload:', error);
      }
    };

    function playClickSound() {
      try {
        const clickSound = document.getElementById('clickSound');
        clickSound.currentTime = 0;
        clickSound.volume = 0.5;
        clickSound.play().catch(error => console.log('Click sound failed:', error));
      } catch (error) {
        console.error('Error in playClickSound:', error);
      }
    }

    function playHoverSound() {
      try {
        const hoverSound = document.getElementById('hoverSound');
        hoverSound.currentTime = 0;
        hoverSound.volume = 0.3;
        hoverSound.play().catch(error => console.log('Hover sound failed:', error));
      } catch (error) {
        console.error('Error in playHoverSound:', error);
      }
    }

    function playCorrectSound() {
      try {
        const correctSound = document.getElementById('correctSound');
        correctSound.currentTime = 0;
        correctSound.volume = 0.5;
        correctSound.play().catch(error => console.log('Correct sound failed:', error));
      } catch (error) {
        console.error('Error in playCorrectSound:', error);
      }
    }

    function playIncorrectSound() {
      try {
        const incorrectSound = document.getElementById('incorrectSound');
        incorrectSound.currentTime = 0;
        incorrectSound.volume = 0.5;
        incorrectSound.play().catch(error => console.log('Incorrect sound failed:', error));
      } catch (error) {
        console.error('Error in playIncorrectSound:', error);
      }
    }

    function showHint() {
      try {
        const calcBot = document.querySelector('.calcbot');
        if (questions[galaxy][level][currentQuestion]) {
          calcBot.setAttribute('data-text', questions[galaxy][level][currentQuestion].hint);
        } else {
          calcBot.setAttribute('data-text', 'No hint available! Try your best!');
        }
        playClickSound();
      } catch (error) {
        console.error('Error in showHint:', error);
      }
    }

    function loadQuestion() {
      try {
        const questionEl = document.querySelector('.question');
        const answersEl = document.querySelector('.answers');
        const resultEl = document.querySelector('.result');
        const nextButton = document.querySelector('.next-button');
        const timerEl = document.querySelector('.timer');
        const progressGraph = document.querySelector('.progress-graph');
        const progressComment = document.querySelector('.progress-comment');
        const reviewGrid = document.querySelector('.review-grid');

        if (!questions[galaxy] || !questions[galaxy][level]) {
          throw new Error(`No questions found for galaxy: ${galaxy}, level: ${level}`);
        }

        if (currentQuestion < questions[galaxy][level].length) {
          const q = questions[galaxy][level][currentQuestion];
          questionEl.textContent = q.question;
          timerEl.textContent = `Questions Remaining: ${questions[galaxy][level].length - currentQuestion}/${questions[galaxy][level].length}`;
          answersEl.innerHTML = '';
          q.answers.forEach(answer => {
            const button = document.createElement('button');
            button.className = 'answer-button';
            button.textContent = answer;
            button.onclick = () => checkAnswer(answer);
            answersEl.appendChild(button);
          });
          resultEl.style.display = 'none';
          nextButton.style.display = 'none';
          progressGraph.style.display = 'none';
          progressComment.style.display = 'none';
          reviewGrid.style.display = 'none';
          document.querySelector('.calcbot').setAttribute('data-text', 'Iâ€™m CalcBot! Click me for hints to solve these cosmic problems!');
        } else {
          questionEl.textContent = `Mission Complete! Score: ${score}/${questions[galaxy][level].length}`;
          timerEl.textContent = '';
          answersEl.innerHTML = '';
          resultEl.style.display = 'none';
          nextButton.style.display = 'none';
          drawProgressGraph();
          progressGraph.style.display = 'block';
          progressComment.style.display = 'block';
          reviewGrid.style.display = 'grid';
          localStorage.setItem('mathQuestProgress', JSON.stringify({
            ...JSON.parse(localStorage.getItem('mathQuestProgress') || '{}'),
            baselineScore: score,
            contentScores: contentScores,
            grade: parseInt(grade)
          }));
        }
      } catch (error) {
        console.error('Error in loadQuestion:', error);
        document.querySelector('.question').textContent = 'Error: Failed to load question. Please check console.';
      }
    }

    function checkAnswer(selected) {
      try {
        const q = questions[galaxy][level][currentQuestion];
        const resultEl = document.querySelector('.result');
        const answerButtons = document.querySelectorAll('.answer-button');
        const nextButton = document.querySelector('.next-button');

        answerButtons.forEach(button => button.disabled = true);
        if (selected === q.correct_answer) {
          score++;
          contentScores[q.contentArea]++;
          resultEl.textContent = `Correct! ${q.explanation}`;
          resultEl.className = 'result correct';
          playCorrectSound();
        } else {
          resultEl.textContent = `Incorrect! ${q.explanation}`;
          resultEl.className = 'result incorrect';
          playIncorrectSound();
        }
        resultEl.style.display = 'block';
        nextButton.style.display = 'block';
      } catch (error) {
        console.error('Error in checkAnswer:', error);
      }
    }

    function nextQuestion() {
      try {
        currentQuestion++;
        loadQuestion();
        playClickSound();
      } catch (error) {
        console.error('Error in nextQuestion:', error);
      }
    }

    function drawProgressGraph() {
      try {
        const canvas = document.getElementById('progressGraph');
        const ctx = canvas.getContext('2d');
        const commentEl = document.querySelector('.progress-comment');
        const reviewBlocks = document.querySelectorAll('.review-block');

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Graph settings
        const barWidth = 100;
        const maxHeight = 200;
        const margin = 20;
        const labels = ['Numbers', 'Algebra', 'Measurement', 'Data'];
        const scores = [
          contentScores.Numbers,
          contentScores.Algebra,
          contentScores.Measurement,
          contentScores.Data
        ];

        // Draw axes
        ctx.strokeStyle = '#00bcd4';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(margin, margin);
        ctx.lineTo(margin, maxHeight + margin);
        ctx.lineTo(margin + 4 * (barWidth + 10), maxHeight + margin);
        ctx.stroke();

        // Draw bars
        ctx.fillStyle = '#ff4081';
        scores.forEach((score, i) => {
          const height = (score / 4) * maxHeight;
          ctx.fillRect(margin + i * (barWidth + 10), maxHeight + margin - height, barWidth, height);
          ctx.fillStyle = '#00bcd4';
          ctx.font = '12px Courier New';
          ctx.fillText(labels[i], margin + i * (barWidth + 10) + 10, maxHeight + margin + 20);
          ctx.fillText(`${score}/4`, margin + i * (barWidth + 10) + 40, maxHeight + margin - height - 5);
          ctx.fillStyle = '#ff4081';
        });

        // Draw Y-axis labels
        ctx.fillStyle = '#00bcd4';
        ctx.font = '12px Courier New';
        for (let i = 0; i <= 4; i++) {
          ctx.fillText(i, margin - 20, maxHeight + margin - (i / 4) * maxHeight + 3);
        }

        // Generate progress comment
        const maxScore = Math.max(...scores);
        const minScore = Math.min(...scores);
        const maxAreas = labels.filter((_, i) => scores[i] === maxScore);
        const minAreas = labels.filter((_, i) => scores[i] === minScore);
        const comment = `Lowest: ${minAreas.join(', ')} (${minScore}/4), Highest: ${maxAreas.join(', ')} (${maxScore}/4)`;
        commentEl.textContent = comment;

        // Generate performance review blocks
        const topicsByArea = {
          Numbers: [...new Set(questions[galaxy][level].filter(q => q.contentArea === 'Numbers').map(q => q.topic))],
          Algebra: [...new Set(questions[galaxy][level].filter(q => q.contentArea === 'Algebra').map(q => q.topic))],
          Measurement: [...new Set(questions[galaxy][level].filter(q => q.contentArea === 'Measurement').map(q => q.topic))],
          Data: [...new Set(questions[galaxy][level].filter(q => q.contentArea === 'Data').map(q => q.topic))]
        };

        // Overall block
        const overallBlock = document.querySelector('.review-block.overall');
        let overallHTML = '<h3>Overall Performance</h3>';
        if (score >= 12) {
          overallHTML += `<p>${score}/16: Stellar score! Keep shining, Cosmic Cadet!</p>`;
        } else if (score >= 6) {
          overallHTML += `<p>${score}/16: Solid effort, Star Navigator! Check tips!</p>`;
        } else {
          overallHTML += `<p>${score}/16: Great start! Focus on key areas.</p>`;
        }
        overallBlock.innerHTML = overallHTML;

        // Content area blocks
        labels.forEach((area, index) => {
          const areaScore = scores[index];
          const block = document.querySelector(`.review-block[data-area="${area}"]`);
          let blockHTML = `<h3>${area} (${areaScore}/4)</h3>`;
          if (areaScore === 4) {
            blockHTML += `<p>Perfect!</p>`;
          } else if (areaScore >= 2) {
            blockHTML += `<p>Good! Refine ${topicsByArea[area].join(', ')}.</p>`;
            blockHTML += `<ul>
              <li>Khan Academy: ${topicsByArea[area][0].toLowerCase()}.</li>
              <li>MathZone: ${topicsByArea[area].length > 1 ? topicsByArea[area][1].toLowerCase() : topicsByArea[area][0].toLowerCase()}.</li>
            </ul>`;
          } else {
            blockHTML += `<p>Focus on ${topicsByArea[area].join(', ')}.</p>`;
            blockHTML += `<ul>
              <li>${area === 'Numbers' ? 'Math is Fun' : area === 'Algebra' ? 'PurpleMath' : area === 'Measurement' ? 'BBC Bitesize' : 'MathsLab'}: ${topicsByArea[area][0].toLowerCase()}.</li>
              <li>IXL: ${topicsByArea[area].length > 1 ? topicsByArea[area][1].toLowerCase() : topicsByArea[area][0].toLowerCase()}.</li>
            </ul>`;
          }
          block.innerHTML = blockHTML;
        });
      } catch (error) {
        console.error('Error in drawProgressGraph:', error);
      }
    }
  </script>
</body>
</html>